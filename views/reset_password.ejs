<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Reset Password â€¢ MyGreenHome</title>
    <link rel="stylesheet" href="/styles/auth.css">
</head>
<body>
    <div class="auth-container">
        <h2>Reset Your Password</h2>
        <p style="text-align: center; margin-bottom: 20px; font-size: 14px; color: #555;">Enter your new password below.</p>

        <% if (error) { %>
            <p class="error-msg" style="text-align: center;"><%= error %></p>
        <% } %>

        <form id="resetPasswordForm" action="/auth/reset-password" method="POST">
            <input type="hidden" name="email" value="<%= email %>">
            
            <div class="form-group password-group">
                <label for="newPassword">New Password <small>(min 6 characters)</small></label>
                <input type="password" id="newPassword" name="newPassword" required minlength="6">
                <button type="button" id="togglePass1" class="toggle-pass">Show</button>
                <div id="capsAlert1" hidden style="color:red; font-size: 12px; margin-top: 5px;">Caps Lock is ON</div>
            </div>

            <div class="form-group password-group">
                <label for="confirmPassword">Confirm New Password</label>
                <input type="password" id="confirmPassword" name="confirmPassword" required>
                <button type="button" id="togglePass2" class="toggle-pass">Show</button>
                <div id="capsAlert2" hidden style="color:red; font-size: 12px; margin-top: 5px;">Caps Lock is ON</div>
            </div>
            <p id="matchError" class="error-msg" style="text-align: center;"></p>

            <div class="form-actions" style="justify-content: center;">
                <button type="submit" id="resetBtn" disabled>Reset Password</button>
            </div>
            <p style="text-align: center; margin-top: 20px; font-size: 14px;">
                <a href="/auth" style="color: #4A90E2; text-decoration: none;">Back to Login</a>
            </p>
        </form>

    <script>
        // Password visibility toggles
        const pwInput1 = document.getElementById('newPassword');
        const toggle1 = document.getElementById('togglePass1');
        const pwInput2 = document.getElementById('confirmPassword');
        const toggle2 = document.getElementById('togglePass2');
        const matchError = document.getElementById('matchError');
        const resetBtn = document.getElementById('resetBtn');

        function setupToggle(input, toggle) {
            toggle.addEventListener('click', () => {
                input.type = input.type === 'password' ? 'text' : 'password';
                toggle.textContent = input.type === 'password' ? 'Show' : 'Hide';
            });
        }
        setupToggle(pwInput1, toggle1);
        setupToggle(pwInput2, toggle2);

        // Caps Lock alert (for both new password fields)
        function setupCapsLockAlert(input, alertDivId) {
            const capsAlert = document.getElementById(alertDivId);
            input.addEventListener('keydown', e => {
                if (e.getModifierState && e.getModifierState('CapsLock')) capsAlert.hidden = false;
            });
            input.addEventListener('keyup', e => {
                if (!e.getModifierState || !e.getModifierState('CapsLock')) capsAlert.hidden = true;
            });
        }
        setupCapsLockAlert(pwInput1, 'capsAlert1');
        setupCapsLockAlert(pwInput2, 'capsAlert2');

        // Password matching validation
        function validatePasswords() {
            if (pwInput1.value === pwInput2.value && pwInput1.value.length >= 6) {
                matchError.textContent = '';
                resetBtn.disabled = false;
            } else if (pwInput1.value.length < 6 && pwInput1.value.length > 0) {
                matchError.textContent = 'New password must be at least 6 characters.';
                resetBtn.disabled = true;
            }
            else if (pwInput1.value !== pwInput2.value && pwInput2.value.length > 0) {
                matchError.textContent = 'Passwords do not match.';
                resetBtn.disabled = true;
            } else {
                 matchError.textContent = '';
                 resetBtn.disabled = true;
            }
             if (pwInput1.value === '' || pwInput2.value === '') {
                 resetBtn.disabled = true;
             }
        }

        pwInput1.addEventListener('input', validatePasswords);
        pwInput2.addEventListener('input', validatePasswords);
    </script>
</body>
</html>